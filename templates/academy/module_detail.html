{% extends "base.html" %}
{% block title %}{{ module.title }} | Close The Gap Academy{% endblock %}
{% block content %}
<div class="row mb-4 align-items-center">
  <div class="col-lg-6 mb-3 mb-lg-0">
    {% if module.image %}
    <img src="{{ module.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ module.title }} cover image" />
    {% else %}
    <div class="module-hero__placeholder d-flex align-items-center justify-content-center text-center p-5 rounded shadow-sm">
      <div>
        <h2 class="h4 mb-1">Close The Gap Academy</h2>
        <p class="text-muted mb-0">Bring your learning journey to life.</p>
      </div>
    </div>
    {% endif %}
  </div>
  <div class="col-lg-6">
    <div class="d-flex align-items-start mb-2 gap-2">
      <h1 class="h2 mb-0">{{ module.title }}</h1>
      {% if module.is_recommended %}
      <span class="badge bg-warning text-dark">Recommended</span>
      {% endif %}
    </div>
    <p class="lead text-secondary">{{ module.description }}</p>
    <p class="display-6 fw-semibold text-primary">${{ module.price|floatformat:2 }}</p>
    <div class="d-flex flex-wrap gap-2">
      {% if user.is_authenticated %}
        {% if has_access %}
        <a class="btn btn-success" href="{% url 'academy:dashboard' %}">Go to Dashboard</a>
        {% else %}
        <a class="btn btn-primary" href="{% url 'academy:purchase_module' module.slug %}">Purchase Access</a>
        {% endif %}
      {% else %}
      <a class="btn btn-primary" href="{% url 'login' %}?next={% url 'academy:module_detail' module.slug %}">Login to Purchase</a>
      {% endif %}
      <a class="btn btn-outline-secondary" href="{% url 'academy:home' %}">Back to catalog</a>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-8">
    <h2 class="h4">Lessons</h2>
    <ul class="list-group mb-4">
      {% for lesson in module.lessons.all %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>{{ lesson.title }}</span>
        {% if has_access %}
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'academy:lesson_detail' module.slug lesson.id %}">View</a>
        {% else %}
        <span class="badge bg-secondary">Purchase required</span>
        {% endif %}
      </li>
      {% empty %}
      <li class="list-group-item">No lessons yet.</li>
      {% endfor %}
    </ul>
    {% if quiz %}
    <div class="card">
      <div class="card-body">
        <h3 class="card-title h5">Module Quiz</h3>
        <p class="card-text">Passing Score: {{ quiz.passing_score }}%</p>
        <a class="btn btn-outline-primary" href="{% url 'academy:take_quiz' module.slug %}">Take Quiz</a>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
